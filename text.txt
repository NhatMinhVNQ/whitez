local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local KeyGuardLibrary = loadstring(game:HttpGet("https://cdn.keyguardian.org/library/v1.0.0.lua"))()

local trueData = "f8f6426175294e5b897ec156b2707189"
local falseData = "6a955f72c2be4cb2b331a383afc7b760"

KeyGuardLibrary.Set({
  publicToken = "4366ad5245fd44bbb53cd1e30dbcb999",
  privateToken = "cea7d78e98c142b685cc80b9b54f03ae",
  trueData = trueData,
  falseData = falseData,
})

local keyFile = "wsj-keys.txt"

local function saveKey(key)
    writefile(keyFile, key)
end

local function loadKey()
    if isfile(keyFile) then
        return readfile(keyFile)
    else
        return nil
    end
end

local function showNotification(title, message, duration)
    game.StarterGui:SetCore("SendNotification", {
        Title = title,
        Text = message,
        Duration = duration or 5
    })
end

local key = loadKey()
local isKeyValid = false

if key then
    local success, response = pcall(function()
        return KeyGuardLibrary.validateDefaultKey(key)
    end)
    if success and response == trueData then
        isKeyValid = true
    end
end

if isKeyValid then
    print("Key Valid, Run Script...")
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Minhdaynebro1/WhiteZ-Hub/refs/heads/main/AA.lua"))()
else
    local Window = Fluent:CreateWindow({
        Title = "WORLD TEAMS - BETA",
        SubTitle = "KEY SYSTEMS",
        TabWidth = 160,
        Size = UDim2.fromOffset(580, 340),
        Acrylic = false,
        Theme = "Dark",
        MinimizeKey = Enum.KeyCode.RightAlt
    })

    local Tabs = {
        KeySys = Window:AddTab({ Title = "Key System", Icon = "key" }),
    }

    local Entkey = Tabs.KeySys:AddInput("Input", {
        Title = "Enter Key",
        Description = "Enter Key here",
        Default = "",
        Placeholder = "Enter keyâ€¦",
        Numeric = false,
        Finished = false,
        Callback = function(Value)
            key = Value
        end
    })

    local Checkkey = Tabs.KeySys:AddButton({
        Title = "Check Key",
        Description = "Enter Key before checking",
        Callback = function()
            if key == "" or not key then
                showNotification("Key System", "Please enter a key before checking!", 5)
                return
            end

            local success, response = pcall(function()
                return KeyGuardLibrary.validateDefaultKey(key)
            end)

            if success and response == trueData then
                showNotification("Key System", "Key is valid! Script is starting...", 5)
                saveKey(key)
                Window:Minimize()
                wait(0.5)
                loadstring(game:HttpGet("https://raw.githubusercontent.com/Minhdaynebro1/WhiteZ-Hub/refs/heads/main/AA.lua"))()
            else
                showNotification("Key System", "Invalid key! Please try again.", 5)
            end
        end
    })

    local Getkey = Tabs.KeySys:AddButton({
        Title = "Get Key",
        Description = "Get Key here",
        Callback = function()
            setclipboard(KeyGuardLibrary.getLink())
            showNotification("Key System", "Key link copied to clipboard!", 5)
        end
    })

    local HowToGetKey = Tabs.KeySys:AddButton({
        Title = "How To Get Key",
        Description = "Instructions to get a key",
        Callback = function()
            setclipboard("https://streamable.com/ykcw5e")
            showNotification("How To Get Key", "Link copied to clipboard!", 5)
        end
    })

    Window:SelectTab(1)
end
